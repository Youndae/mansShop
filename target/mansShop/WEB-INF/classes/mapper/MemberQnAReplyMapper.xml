<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.shop.mapper.MemberQnAReplyMapper">

    <select id="findAllByQnAId" resultType="QnAReplyListDTO">
        SELECT r.id as replyId
             , CASE
                   WHEN m.nickname is null
                       THEN m.userId
                   ELSE m.nickname
            END as writer
            , r.replyContent as content
            , r.updatedAt as updatedAt
        FROM memberQnAReply r
        INNER JOIN member m
            ON r.userId = m.userId
        WHERE r.qnaId = #{qnaId}
    </select>

    <select id="findById" resultType="MemberQnAReply">
        SELECT *
        FROM memberQnAReply
        WHERE id = #{id}
    </select>

    <update id="patchContent" parameterType="MemberQnAReply">
        UPDATE memberQnAReply
        SET replyContent = #{replyContent}
        WHERE id = #{id}
    </update>

    <insert id="insertReply" parameterType="MemberQnAReply">
        INSERT INTO memberQnAReply(
                userId
                , qnaId
                , replyContent
        )
        VALUES (
                #{userId}
                , #{qnaId}
                , #{replyContent}
               )
    </insert>

</mapper>